{% extends 'common/base.njk' %}
{% set title = 'Help With Hint' %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}

{% block backLink %}
  {{ govukBackLink({ text: "Back", href: "/organisation-type" }) }}
{% endblock %}
{% block content %}

  <form method="post" action="/validate-help-with-hint" id="helpWithHintForm" >

    {{ govukCheckboxes({
  name: "helpWithHint",
  fieldset: {
    legend: {
      text: "What would you like help with?",
      isPageHeading: true,
      classes: "govuk-fieldset__legend--l"
    }
  },
  hint: {
    text: "Tick all that apply - this will help us understand your initial needs"
  },
   errorMessage: {
    text: "Select one or more options"
  } if showError, 
  items: [
    {
      value: "Getting access to the integration environment to test GOV.UK One Login",
      text: "Getting access to the integration environment to test GOV.UK One Login"
    },
    {
      value: "Having a technical discussion",
      text: "Having a technical discussion"
    },
    {
      value: "Walking through the onboarding process",
      text: "Walking through the onboarding process"
    },
    {
      value: "Understanding the GOV.UK One Login programme in more detail",
      text: "Understanding the GOV.UK One Login programme in more detail"
    },
     {
      value: "other",
      text: "Other"
    }
  ]
}) }}

    {{ govukButton({
  text: "Continue",
  type: "submit"
}) }}
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const storedHelpWithHints = localStorage.getItem("helpWithHint");
      const form = document.getElementById("helpWithHintForm");

      if (storedHelpWithHints) {
        const storedValues = storedHelpWithHints.split("/");
        storedValues.forEach((value) => {
          const checkbox = form.querySelector(`input[value="${value}"]`);
          if (checkbox) {
            checkbox.checked = true;
          }
        });
      }

      form.addEventListener("submit", function (event) {
        event.preventDefault();

        const checkedItems = Array
          .from(form.querySelectorAll('input[type=checkbox]:checked'))
          .map(
            (checkbox) => checkbox
            ?.value);

        localStorage.setItem("helpWithHint", checkedItems.join("/"));

        form.submit();
      });
    });
  </script>
{% endblock %}